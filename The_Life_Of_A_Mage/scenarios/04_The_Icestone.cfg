[scenario]
#textdomain wesnoth-The_Life_Of_A_Mage
name= _ "The Icestone"
id=04_The_Icestone
turns=25
{LM_MAP 04_The_Icestone.map}
next_scenario=05_Betrayal
victory_when_enemies_defeated=no
[music]
	name=legends_of_the_north.ogg
[/music]

	{UNDERGROUND}

	[side]
		type=Apprentice Mage
		description=Dillon
		user_description= _ "Dillon"
		unrenamable=yes
		side=1
		canrecruit=1
		profile=portraits/dillon.png
		controller=human
		team_name=children
	[/side]
	
	[side]
		no_leader=yes
		controller=ai
		team_name=fire
	[/side]
	
	[story]
		[part]
			story= _ "Dillon and Lhyron entered the chamber of the Icestone. The two magi walked forward slowly, unsure what to expect."
		[/part]
	[/story]
	
#define LAVA_FILL_A
	[terrain_mask]
		x,y=1,1
		mask="usage=mask
border_size=0

Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , _f          , _f          , _f          , _f          , _f          , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
"
	[/terrain_mask]
#enddef

#define LAVA_FILL_B Y
	[terrain_mask]
		x=1
		y={Y}
		mask="usage=mask
border_size=0

 Qlf        , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , Qlf         , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , _f          , _f          , _f          , _f          , _f          , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          
_f          , _f          , _f          , _f          , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , Qlf         , Qlf         , _f          , _f          , _f          , _f          , _f          , _f          , _f          

"
	[/terrain_mask]
#enddef

#define STONE_TAKEN
	{TREMOR}
	{LAVA_FILL_A}
	{PLACE_FIRE_RING}
	[redraw]
	[/redraw]
	#I'm open to new and better names if anyone has them
	[unit]
		description=Scorch
		user_description= _ "Scorch"
		x=11
		y=2
		type=Fire Ghost
		side=2
	[/unit]
#ifdef MEDIUM
	[unit]
		description=Blaze
		user_description= _ "Blaze"
		x=7
		y=4
		type=Fire Ghost
		side=2
	[/unit]
#endif
#ifdef HARD
	[unit]
		description=Blaze
		user_description= _ "Blaze"
		x=7
		y=4
		type=Fire Ghost
		side=2
	[/unit]
	[unit]
		description=Ember
		user_description= _ "Ember"
		x=15
		y=4
		type=Fire Ghost
		side=2
	[/unit]
#endif
	[message]
		speaker=Scorch
		message= _ "Ha ha ha! Free at last! Poor fools. They shall suffer an utter oblivion of fire."
	[/message]
	[message]
		speaker=Blaze
		message= _ "Heh heh heh! It shall consume their flesh!"
	[/message]
	[message]
		speaker=Ember
		message= _ "Hee hee hee! Until they crackle and pop!"
	[/message]
	[message]
		speaker=Lhyron
		message= _ "(shudder) What are those things?"
	[/message]
	[message]
		speaker=Dillon
		message= _ "I haven't the faintest idea, and I'm not sticking around to find out."
	[/message]
	[objectives]
		side=1
		[objective]
			description= _ "Move Dillon to the tunnel enterance to escape"
			condition=win
		[/objective]
		[objective]
			description= _ "Death of Dillon or Lhyron"
			condition=lose
		[/objective]
		[objective]
			description= _ "Turns run out"
			condition=lose
		[/objective]
	[/objectives]
#enddef

#define PLACE_FIRE_RING
	{PLACE_IMAGE items/firecircle-s.png 11 5}
	{PLACE_IMAGE items/firecircle-sw.png 10 4}
	{PLACE_IMAGE items/firecircle-se.png 12 4}
	{PLACE_IMAGE items/firecircle-n.png 11 3}
	{PLACE_IMAGE items/firecircle-nw.png 10 3}
	{PLACE_IMAGE items/firecircle-ne.png 12 3}
#enddef

	[event]
		name=prestart
		[recall]
			description=Lhyron
		[/recall]
		[objectives]
			side=1
			[objective]
				description= _ "Capture the Icestone with Dillon"
				condition=win
			[/objective]
			[objective]
				description= _ "Death of Dillon or his friends"
				condition=lose
			[/objective]
			[objective]
				description= _ "Turns run out"
				condition=lose
			[/objective]
		[/objectives]
		{PLACE_IMAGE items/icecircle-s.png 11 5}
		{PLACE_IMAGE items/icecircle-sw.png 10 4}
		{PLACE_IMAGE items/icecircle-se.png 12 4}
		{PLACE_IMAGE items/icecircle-n.png 11 3}
		{PLACE_IMAGE items/icecircle-nw.png 10 3}
		{PLACE_IMAGE items/icecircle-ne.png 12 3}
		{PLACE_IMAGE items/altar.png 11 4}
		{PLACE_IMAGE items/icestone.png 11 4}
		{VARIABLE stone_taken 0}
		{VARIABLE turns_since_taken 0}
	[/event]
	
	[event]
		name=start
		[message]
			speaker=Dillon
			message= _ "Here we are."	
		[/message]
		[message]
			speaker=Lhyron
			message= _ "There it is! There's the Icestone!"	
		[/message]
		[recall]
			description=Slinian
		[/recall]
		[recall]
			description=Jamarn
		[/recall]
		[redraw]
		[/redraw]
		[message]
			speaker=Lhyron
			message= _ "Hey! What are you two doing here?"	
		[/message]
		[message]
			speaker=Slinian
			message= _ "We heard you talking to Dillon and we're coming to look for the stone too."	
		[/message]
		[message]
			speaker=Dillon
			message= _ "But wait..."	
		[/message]
		[message]
			speaker=Lhyron
			message= _ "Leave it, Dillon. We're going to need all the help we can get if we're going to succeed in capturing the stone."	
		[/message]
		[message]
			speaker=Dillon
			message= _ "I don't want to endanger any other students."	
		[/message]
		[message]
			speaker=Slinian
			message= _ "This whole escapade endangered the students involved. Its what we signed up for."	
		[/message]
		[message]
			speaker=Lhyron
			message= _ "Honestly Dillon, you're always too noble. You need to think of yourself once in a while."
		[/message]
		[message]
			speaker=Dillon
			message= _ "..."
		[/message]
		[message]
			speaker=Slinian
			message= _ "Well, what are we waiting for? To the stone!"
		[/message]
	[/event]
	
	#Gives the stone to Dillon
	[event]
		name=moveto
		[filter]
			x=11
			y=4
			description=Dillon
		[/filter]
		{GIVE_ICESTONE Dillon ("The Icestone was created by powerful magi long ago. It glows with a mysterious blue power")}
		[removeitem]
		x,y=11,4
		[/removeitem]
		{PLACE_IMAGE items/altar.png 11 4}
		[message]
			speaker=narrator
			message= _ "Dillon reaches slowly for the Stone. The powerful object pulses rapidly as it prepares to leave its resting place."	
		[/message]
		[message]
			speaker=Dillon
			message= _ "Its so cold!"
		[/message]
		[message]
			speaker=Lhyron
			message= _ "What did you expect? It's the Icestone!"
		[/message]
		[message]
			speaker=Dillon
			message= _ "Well, it is done then. We've taken it."
		[/message]
		[message]
			speaker=Lhyron
			message= _ "Let's get out of here."
		[/message]
		{VARIABLE stone_taken 1}
	[/event]
	
	#Explains why the stone will only go to Dillon
	[event]
		name=moveto
		[filter]
			x=11
			y=4
			description=Lhyron
		[/filter]
		[message]
			speaker=Dillon
			message= _ "Well, what are you waiting for?"
		[/message]
		[message]
			speaker=Lhyron
			message= _ "I don't dare."
		[/message]
		[message]
			speaker=Dillon
			message= _ "You were the one who wanted to take it!"
		[/message]
		[message]
			speaker=Lhyron
			message= _ "You are the one who is supposed to take it."
		[/message]
		[message]
			speaker=Dillon
			message= _ "Fine."
		[/message]
	[/event]
	
	[event]
		name=moveto
		[filter]
			x=11
			y=4
			description=Slinian
		[/filter]
		[message]
			speaker=Slinian
			message= _ "Am I supposed to take it?"
		[/message]
		[message]
			speaker=Lhyron
			message= _ "Well, duh. Its sitting right in front of you!"
		[/message]
		[message]
			speaker=Slinian
			message= _ "But suppose its dangerous?"
		[/message]
		[message]
			speaker=Lhyron
			message= _ "(Snicker)"
		[/message]
		[message]
			speaker=Slinian
			message= _ "Dillon's supposed to take it."
		[/message]
		[message]
			speaker=Dillon
			message= _ "Alright then."
		[/message]
	[/event]
	
	[event]
		name=moveto
		[filter]
			x=11
			y=4
			description=Jamarn
		[/filter]
		[message]
			speaker=Jamarn
			message= _ "I'm too scared to take it."
		[/message]
		[message]
			speaker=Lhyron
			message= _ "Dillon, you'd better take it."
		[/message]
		[message]
			speaker=Dillon
			message= _ "Okay."
		[/message]
	[/event]
	
	#Activates the cave
	[event]
		name=moveto
		first_time_only=no
		[if]
			[variable]
				name=stone_taken
				equals=1
			[/variable]
			[then]
				{VARIABLE stone_taken 0}
				{STONE_TAKEN}
				{VARIABLE turns_since_taken 1}
			[/then]
		[/if]
	[/event]
	
	#Turns the cave into lava
	[event]
		name=new turn
		first_time_only=no
		[if]
			[variable]
				name=turns_since_taken
				greater_than=0
			[/variable]
			[then]
				{TREMOR}
				{LAVA_FILL_B ($turns_since_taken-1)}
				[set_variable]
					name=turns_since_taken
					add=1
				[/set_variable]
			[/then]
		[/if]
		{TIS_LAVA_DESTROY}
		[redraw]
		[/redraw]
		{TIS_LAVA_KILL}
		#Characters respond to the caves collapse, but only once
		[if]
			[variable]
				name=turns_since_taken
				equals=2
			[/variable]
			[then]
				[message]
					speaker=Lhyron
					message= _ "The cave is falling apart!"
				[/message]
				[message]
					speaker=Dillon
					message= _ "We got to get out!"
				[/message]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=moveto
		[filter]
			description=Dillon
			x=10-12
			y=20
		[/filter]
		[message]
			speaker=Dillon
			message= _ "Come on, guys!"
		[/message]
		[message]
			speaker=Lhyron
			message= _ "We're right behind you!"
		[/message]
		{CLEAR_VARIABLE stone_taken}
		[endlevel]
			result=victory
			bonus=yes
		[/endlevel]
	[/event]
	
	{MAGE_DEATHS}
	{SLINIAN_DEATHS}
	{VICTORY_DEFEAT_MUSIC}
	
[/scenario]